<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>YouTube Stream Viewer</title>

<style>
  :root {
    --vh: 1vh; /* updated dynamically */
  }

  body {
    margin: 0;
    background: #111;
    color: #eee;
    font-family: system-ui, sans-serif;
    overflow-x: hidden;
  }

  header {
    padding: 1rem;
    display: flex;
    gap: 0.5rem;
    align-items: center;
    background: #111;
    position: relative;
    z-index: 10;
  }

  input {
    flex: 1;
    padding: 0.5rem;
    border-radius: 4px;
    border: 1px solid #444;
    background: #222;
    color: #eee;
  }

  button {
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 4px;
    background: #e53935;
    color: #fff;
    font-weight: 600;
    cursor: pointer;
  }

  /* Fullscreen toggle button — normal mode */
  #fs-btn {
    position: relative;
    z-index: 10;
    margin-left: 0.5rem;
  }

  /* Fullscreen mode: float above everything */
  #fs-btn.fullscreen-active {
    position: fixed;
    top: 10px;
    right: 10px;
    z-index: 99999;
    opacity: 0.9;
  }

  /* Main layout */
  #container {
    display: grid;
    grid-template-columns: 1fr;
    grid-template-rows: auto 1fr;
    height: calc(var(--vh) * 100 - 70px);
    overflow: hidden;
  }

  /* Wide screens: video left, chat right */
  @media (min-width: 900px) {
    #container {
      grid-template-columns: 2fr 1fr;
      grid-template-rows: 1fr;
    }
  }

  /* 16:9 video wrapper */
  #video-wrapper {
    position: relative;
    width: 100%;
    aspect-ratio: 16 / 9;
    background: #000;
  }

  #video-frame {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    border: none;
  }

  /* Chat fills remaining space */
  #chat-frame {
    width: 100%;
    height: 100%;
    border: none;
    background: #000;
  }

  /* Fullscreen mode */
  .fullscreen,
  .pseudo-fullscreen {
    position: fixed !important;
    inset: 0 !important;
    z-index: 9998 !important;
    display: grid !important;
    width: 100vw !important;
    height: calc(var(--vh) * 100) !important;
    overflow: hidden !important;
  }

  /* Fullscreen layout: narrow screens → chat below */
  .fullscreen,
  .pseudo-fullscreen {
    grid-template-columns: 1fr;
    grid-template-rows: auto 1fr;
  }

  /* Fullscreen layout: wide screens → chat right */
  @media (min-width: 900px) {
    .fullscreen,
    .pseudo-fullscreen {
      grid-template-columns: 3fr 1fr !important;
      grid-template-rows: 1fr !important;
    }
  }
</style>
</head>

<body>

<header>
  <input id="yt-input" placeholder="YouTube URL or ID" />
  <button id="load-btn">Load</button>
  <button id="fs-btn"><sup>⇱</sup><sub>⇲</sub></button>
</header>

<div id="container">
  <div id="video-wrapper">
    <iframe id="video-frame" allow="autoplay; encrypted-media" allowfullscreen></iframe>
  </div>
  <iframe id="chat-frame"></iframe>
</div>

<script>
  const input = document.getElementById("yt-input");
  const loadBtn = document.getElementById("load-btn");
  const fsBtn = document.getElementById("fs-btn");
  const container = document.getElementById("container");
  const videoFrame = document.getElementById("video-frame");
  const chatFrame = document.getElementById("chat-frame");

  const EMBED_DOMAIN = window.location.hostname;

  /* Fix iOS viewport height */
  function updateVh() {
    document.documentElement.style.setProperty("--vh", `${window.innerHeight * 0.01}px`);
  }
  updateVh();
  window.addEventListener("resize", updateVh);

  function extractVideoId(value) {
    value = value.trim();
    if (!value.includes("http")) return value;

    try {
      const url = new URL(value);
      if (url.searchParams.has("v")) return url.searchParams.get("v");
      if (url.hostname.includes("youtu.be")) return url.pathname.split("/").pop();
      if (url.pathname.startsWith("/embed/")) return url.pathname.split("/").pop();
      if (url.pathname.startsWith("/live/")) return url.pathname.split("/").pop();
    } catch {}
    return null;
  }

  function loadStream() {
    const id = extractVideoId(input.value);
    if (!id) return alert("Invalid YouTube ID");

    videoFrame.src = `https://www.youtube.com/embed/${id}`;
    chatFrame.src =
      `https://www.youtube.com/live_chat?v=${id}&embed_domain=${EMBED_DOMAIN}`;
  }

  loadBtn.onclick = loadStream;
  input.onkeydown = e => e.key === "Enter" && loadStream();

  function isIOS() {
    return /iPad|iPhone|iPod/.test(navigator.userAgent);
  }

  function toggleFullscreen() {
    const isFull =
      document.fullscreenElement ||
      container.classList.contains("pseudo-fullscreen");

    if (isFull) {
      // EXIT FULLSCREEN
      if (document.fullscreenElement) document.exitFullscreen();
      container.classList.remove("fullscreen", "pseudo-fullscreen");

      fsBtn.classList.remove("fullscreen-active");
      fsBtn.innerHTML = "<sup>⇱</sup><sub>⇲</sub>"; // enter icon
      return;
    }

    // ENTER FULLSCREEN
    if (!isIOS() && container.requestFullscreen) {
      container.requestFullscreen();
      container.classList.add("fullscreen");
    } else {
      container.classList.add("pseudo-fullscreen");
    }

    fsBtn.classList.add("fullscreen-active");
    fsBtn.innerHTML = "<sup>⇲</sup><sub>⇱</sub>"; // exit icon
  }

  fsBtn.onclick = toggleFullscreen;
</script>

</body>
</html>
